#!/usr/bin/env python3
import json
import requests
import os
from datetime import datetime
from bs4 import BeautifulSoup


DEFAULT_OPENAI_PRICE = """
<tbody><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4.1</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4.1-2025-04-14</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$8.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4.1-mini</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4.1-mini-2025-04-14</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.40</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.10</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.60</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4.1-nano</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4.1-nano-2025-04-14</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.10</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.025</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.40</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4.5-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4.5-preview-2025-02-27</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$75.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$37.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$150.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-2024-08-06</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.25</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$10.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-audio-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-audio-preview-2024-12-17</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$10.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-realtime-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-realtime-preview-2024-12-17</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$5.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$20.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-mini</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-mini-2024-07-18</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.15</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.075</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.60</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-mini-audio-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-mini-audio-preview-2024-12-17</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.15</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.60</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-mini-realtime-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-mini-realtime-preview-2024-12-17</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.60</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.30</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.40</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o1</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o1-2024-12-17</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$15.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$7.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$60.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o1-pro</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o1-pro-2025-03-19</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$150.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$600.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o3</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o3-2025-04-16</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$10.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$40.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o4-mini</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o4-mini-2025-04-16</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.10</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.275</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$4.40</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o3-mini</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o3-mini-2025-01-31</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.10</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.55</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$4.40</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">o1-mini</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">o1-mini-2024-09-12</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.10</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.55</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$4.40</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">codex-mini-latest</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">codex-mini-latest</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.375</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$6.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-mini-search-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-mini-search-preview-2025-03-11</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.15</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$0.60</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-4o-search-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-4o-search-preview-2025-03-11</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$2.50</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$10.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r border-b" rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">computer-use-preview</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">computer-use-preview-2025-03-11</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$3.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$12.00</div></div></td></tr><tr class="border-0 border-solid border-b last:border-b-0 border-gray-100 dark:border-gray-200"><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-r " rowspan="1"><div><div class="flex items-center group gap-2 text-nowrap"><div class="text-gray-900">gpt-image-1</div></div><div class="flex items-center gap-1 mt-1 text-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 24 24" class="w-4 h-4 text-gray-600"><path fill-rule="evenodd" d="M5 6a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h9.586l-2.293-2.293a1 1 0 0 1 1.414-1.414l4 4a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414-1.414L16.586 14H7a3 3 0 0 1-3-3V7a1 1 0 0 1 1-1Z" clip-rule="evenodd"></path></svg><div class="text-xs text-gray-600">gpt-image-1</div></div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$5.00</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 text-gray-600 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">$1.25</div></div></td><td class="px-4 py-2 align-middle border-0 border-solid border-gray-100 dark:border-gray-200 border-t border-gray-100 dark:border-gray-200"><div class="flex items-baseline w-full gap-2"><div class="text-right flex-1">-</div></div></td></tr></tbody>
"""

CLAUDE_PRICES = [
 {
    "model": "claude-sonnet-4-20250514",
    "type": "tokens",
    "channel_type": 14,
    "input": 3 / 1000 / 0.002,
    "output": 15 / 1000 / 0.002,
  },
  {
      "model": "claude-opus-4-20250514",
      "type": "tokens",
      "channel_type": 14,
      "input": 15 / 1000 / 0.002,
      "output": 75 / 1000 / 0.002,
  },
]



def parse_price_table(html_content):
    soup = BeautifulSoup(html_content, "html.parser")
    prices = []

    # 找到所有行
    rows = soup.find_all("tr")

    for row in rows:
        # 获取模型名称
        model_name = row.find("div", class_="text-gray-900")
        second_model_name = row.find("div", class_="text-gray-600")
        if second_model_name:
            second_model_name = second_model_name.text.strip()
        if not model_name:
            continue

        model_name = model_name.text.strip()

        # 获取价格单元格
        price_cells = row.find_all("div", class_="text-right flex-1")
        if len(price_cells) < 3:
            continue

        # 提取价格
        input_price = price_cells[0].text.strip().replace("$", "")
        cached_price = price_cells[1].text.strip().replace("$", "").replace("-", "0")
        output_price = price_cells[2].text.strip().replace("$", "").replace("-", "0")

        try:
            input_price = float(input_price)
            cached_price = float(cached_price)
            output_price = float(output_price)
            temp_price = {
                "model": model_name,
                "type": "tokens",
                "channel_type": 1,
                "input": input_price / 1000 / 0.002,
                "output": output_price / 1000 / 0.002
            }
            if cached_price:
              temp_price['extra_ratios'] = {
                 "cached_tokens": cached_price / 1000 / 0.002,
              }
            prices.append(temp_price)
            if second_model_name:
                temp_price_2 = temp_price.copy()
                temp_price_2["model"] = second_model_name
                prices.append(temp_price_2)
        except ValueError:
            continue

    return prices


def sync_prices():
    # 解析默认价格
    default_prices = parse_price_table(DEFAULT_OPENAI_PRICE)
    default_prices += CLAUDE_PRICES
    
    # 创建默认价格的查找字典
    default_prices_dict = {item['model']: item for item in default_prices}

    # 源数据URL
    source_url = (
        "https://raw.githubusercontent.com/MartialBE/one-api/prices/prices.json"
    )

    try:
        # 获取源数据
        response = requests.get(source_url)
        response.raise_for_status()
        prices_data = response.json()

        # 用默认价格覆盖远程数据
        for i, price in enumerate(prices_data):
            if price['model'] in default_prices_dict:
                prices_data[i] = default_prices_dict[price['model']]
                # 从默认价格字典中删除已使用的项
                del default_prices_dict[price['model']]

        # 将剩余的默认价格添加到数据中
        prices_data.extend(default_prices_dict.values())

        # 确保目标目录存在
        os.makedirs("prices", exist_ok=True)

        # 写入本地文件
        with open("prices/prices.json", "w", encoding="utf-8") as f:
            json.dump(prices_data, f, ensure_ascii=False, indent=2)

        print("价格数据同步成功！")
        return True

    except Exception as e:
        print(f"同步失败: {str(e)}")
        return False


if __name__ == "__main__":
    sync_prices()
